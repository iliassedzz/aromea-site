<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Aromea - Commander</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <div id="header"></div>

  <main class="commande-page">
    <h2>Votre commande</h2>

    <!-- ===== FILTRES PAR CAT√âGORIE ===== -->
    <div class="filters">
      <button onclick="filtrerCategorie('plats')" class="active">Plats</button>
      <button onclick="filtrerCategorie('desserts')">Desserts</button>
      <button onclick="filtrerCategorie('boissons')">Boissons</button>
    </div>
    <div style="margin-top: 10px;">
      <button onclick="viderPanier()" class="btn-clear">Vider le panier</button>
    </div>

    <!-- ===== PANIER D√âTAILL√â ===== -->
    
<section id="panier">
  <h3>Articles s√©lectionn√©s :</h3>
  <div id="liste-panier"></div>
  <p id="total-global" class="total-global">Total de la commande : 0,00 ‚Ç¨</p>
</section>


    <!-- ===== FORMULAIRE CLIENT ===== -->
    <section class="formulaire">
      <h3>Vos informations</h3>
      <form id="form-commande">
        <label for="nom">Nom :</label>
        <input type="text" id="nom" name="nom" required />

        <label for="adresse">Adresse :</label>
        <input type="text" id="adresse" name="adresse" required />

        <label for="tel">T√©l√©phone :</label>
        <input type="tel" id="tel" name="tel" required />

        <button type="submit">Valider la commande</button>
      </form>
    </section>

    <!-- ‚úÖ R√âCAPITULATIF COMMANDE -->
    <section id="recapitulatif" style="display: none;">
      <h3>R√©capitulatif de votre commande</h3>
      <div id="details-recap"></div>
    </section>
    
    </main>
    
  <div id="footer"></div>

  <!-- ===== SCRIPT POUR LA GESTION DU PANIER ===== -->
  <script>
    let categorieActive = 'plats';

    function afficherPanier() {
  const panier = JSON.parse(localStorage.getItem('panierDetaille')) || [];
  const container = document.getElementById('liste-panier');
  container.innerHTML = '';

  const articlesCategorie = panier.filter(item => item.categorie === categorieActive);

  articlesCategorie.forEach((item) => {
    const div = document.createElement('div');
    div.className = 'panier-item';
    div.innerHTML = `
      <span><strong>${item.nom}</strong> √ó ${item.quantite} ‚Äî ${(item.prix * item.quantite).toFixed(2)} ‚Ç¨</span>
      <div class="controls">
        <button onclick="changerQuantite('${item.nom}', '${item.categorie}', 1)">+</button>
        <button onclick="changerQuantite('${item.nom}', '${item.categorie}', -1)">‚úñ</button>
      </div>
    `;
    container.appendChild(div);
  });

  // === TOTAL PAR CAT√âGORIE ===
  const total = articlesCategorie.reduce((sum, item) => sum + item.prix * item.quantite, 0);
  const totalDiv = document.createElement('div');
  totalDiv.className = 'panier-total';
  totalDiv.innerHTML = `<strong>Total : ${total.toFixed(2)} ‚Ç¨</strong>`;
  container.appendChild(totalDiv);

  // === TOTAL GLOBAL ===
  const totalGlobal = panier.reduce((sum, item) => sum + item.prix * item.quantite, 0);
  const totalGlobalElement = document.getElementById('total-global');
  const totalArticles = panier.reduce((sum, item) => sum + item.quantite, 0);
  totalGlobalElement.textContent = `Total de la commande : ${totalGlobal.toFixed(2).replace('.', ',')} ‚Ç¨ (${totalArticles} article${totalArticles > 1 ? 's' : ''})`;

}


    function changerQuantite(nom, categorie, delta) {
      let panier = JSON.parse(localStorage.getItem('panierDetaille')) || [];
      const index = panier.findIndex(item => item.nom === nom && item.categorie === categorie);

      if (index !== -1) {
        panier[index].quantite += delta;

        // Supprimer si quantit√© tombe √† 0 ou moins
        if (panier[index].quantite <= 0) {
          panier.splice(index, 1);
        }

        localStorage.setItem('panierDetaille', JSON.stringify(panier));
        afficherPanier();
        mettreAJourBadgeNav(); // ‚úÖ met √† jour le badge quand on modifie la quantit√©
      }
    }

    function filtrerCategorie(cat) {
      categorieActive = cat;
      document.querySelectorAll('.filters button').forEach(btn => {
        btn.classList.remove('active');
        if (btn.textContent.toLowerCase().includes(cat)) {
          btn.classList.add('active');
        }
      });
      afficherPanier();
    }

    document.getElementById('form-commande').addEventListener('submit', function(e) {
      e.preventDefault();

      const nom = document.getElementById('nom').value;
      const adresse = document.getElementById('adresse').value;
      const tel = document.getElementById('tel').value;
      const panier = JSON.parse(localStorage.getItem('panierDetaille')) || [];

      console.log("Commande valid√©e !", { nom, adresse, tel, panier });
      const detailsRecap = document.getElementById('details-recap');
let recapHTML = `<p><strong>Nom :</strong> ${nom}</p>`;
recapHTML += `<p><strong>Adresse :</strong> ${adresse}</p>`;
recapHTML += `<p><strong>T√©l√©phone :</strong> ${tel}</p>`;
recapHTML += `<h4>Articles command√©s :</h4><ul>`;

let totalCommande = 0;
panier.forEach(item => {
  const sousTotal = item.prix * item.quantite;
  totalCommande += sousTotal;
  recapHTML += `<li>${item.nom} √ó ${item.quantite} ‚Äî ${sousTotal.toFixed(2).replace('.', ',')} ‚Ç¨</li>`;
});

recapHTML += `</ul><p><strong>Total :</strong> ${totalCommande.toFixed(2).replace('.', ',')} ‚Ç¨</p>`;

detailsRecap.innerHTML = recapHTML;

// Afficher le r√©capitulatif
document.getElementById('recapitulatif').style.display = 'block';

// Masquer le formulaire
document.querySelector('.formulaire').style.display = 'none';

// Vider le panier
localStorage.removeItem('panierDetaille');

    });

    function viderPanier() {
  localStorage.removeItem('panierDetaille');
  afficherPanier();
  mettreAJourBadgeNav();
}

function mettreAJourBadgeNav() {
  const panier = JSON.parse(localStorage.getItem('panierDetaille')) || [];
  const totalArticles = panier.reduce((sum, item) => sum + item.quantite, 0);
  const badge = document.getElementById('nav-badge');
  if (badge) {
    badge.textContent = totalArticles > 0 ? totalArticles : '';

    // Ajoute l'effet de rebond
    badge.classList.remove('bounce');
    void badge.offsetWidth; // üîÑ force le reflow pour relancer l'animation
    badge.classList.add('bounce');
  }
}
mettreAJourBadgeNav();


    // Chargement du header/footer
    fetch('header.html').then(res => res.text()).then(data => {
  document.getElementById('header').innerHTML = data;
  mettreAJourBadgeNav(); // üëà Appeler la fonction APR√àS que le header est en place
});

    fetch('footer.html').then(res => res.text()).then(data => {
      document.getElementById('footer').innerHTML = data;
    });

    // Initialisation
    afficherPanier();
  </script>
</body>
</html>
